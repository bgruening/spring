<tool id="hhsearch" name="HHsearch" version="0.1.0" python_template_version="3.5">
    <description>detecting remote homologues of proteins</description>
    <requirements>
        <requirement type="package" version="3.2.0">hhsuite</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        link '$hhm_ffdata' hhdb_hhm.ffdata &&
        link '$hhm_ffindex' hhdb_hhm.ffindex &&
        link '$cs219_ffdata' hhdb_cs219.ffdata &&
        link '$cs219_ffindex' hhdb_cs219.ffindex &&
        $method -e '$e' -i '$input' -d hhdb -o '$output'
    ]]></command>
    <inputs>
        <param format="data" name="input" type="data" label="Query Sequence" help="Single sequence or multiple sequence alignment (MSA)
                in a3m, a2m, or FASTA format, or HMM in hhm format. (-i)"/>
        <param format="txt" name="hhm_ffindex" type="data" label="HHM Index file" help="Database file ending with 'hhm.ffindex'."/>
        <param format="data" name="hhm_ffdata" type="data" label="HHM Data file" help="Database file ending with 'hhm.ffdata'."/>
        <param format="txt" name="cs219_ffindex" type="data" label="cs219 Index file" help="Database file ending with 'cs219.ffindex'."/>
        <param format="data" name="cs219_ffdata" type="data" label="cs219 Data file" help="Database file ending with 'cs219.ffdata'."/>
        <param name="method" type="select" display="radio" label="Search Method" help="Select a search method. See help below for more information.">
            <option value="hhsearch" selected="true">HHsearch</option>
            <option value="hhblits">HHblits</option>
        </param>
        <param name="e" type="float" label="E-value cutoff for inclusion in result alignment. (-e)" value="0.001" min="0" max="1"/>
    </inputs>
    <outputs>
        <data format="txt" name="output" />
    </outputs>
    <tests>
        <test>
            <param name="method" value="hhblits"/>
            <param name="input" value="6VYB_A.fasta"/>
            <param name="hhm_ffindex" value="dbCAN-fam-V8/dbCAN-fam-V8_hhm.ffindex"/>
            <param name="hhm_ffdata" value="dbCAN-fam-V8/dbCAN-fam-V8_hhm.ffdata"/>
            <param name="cs219_ffindex" value="dbCAN-fam-V8/dbCAN-fam-V8_cs219.ffindex"/>
            <param name="cs219_ffdata" value="dbCAN-fam-V8/dbCAN-fam-V8_cs219.ffdata"/>
            <output name="output" file="6VYB_A.hhr" lines_diff="4"/>
        </test>
    </tests>
    <help><![CDATA[
HHsearch aligns a profile HMM against a database of target profile HMMs. The search first aligns the
query HMM with each of the target HMMs using the Viterbi dynamic programming algorithm, which finds the
alignment with the maximum score. The E-value for the target HMM is calculated from the Viterbi score. 
Target HMMs that reach sufficient significance to be reported are realigned using the Maximum Accuracy algorithm (MAC).
This algorithm maximizes the expected number of correctly aligned pairs of residues minus a penalty between 0 and 1.
Values near 0 produce greedy, long, nearly global alignments, values above 0.3 result in shorter, local alignments.

HHblits is an accelerated version of HHsearch that is fast enough to perform iterative searches through millions of profile HMMs,
e.g. through the Uniclust profile HMM databases, generated by clustering the UniProt database into clusters of globally alignable sequences. 
Analogously to PSI-BLAST and HMMER3, such iterative searches can be used to build MSAs by starting from a single query sequence.
Sequences from matches to profile HMMs below some E-value threshold (e.g. 10âˆ’3) are added to the query MSA for the next search iteration.

Download databases from: http://wwwuser.gwdg.de/~compbiol/data/hhsuite/databases/hhsuite_dbs/
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubhh-suite,
  author = {Soeding, Johannes},
  year = {2005},
  title = {Protein homology detection by HMM-HMM comparison},
  publisher = {Oxford University Press},
  journal = {Bioinformatics},
  url = {https://doi.org/10.1093/bioinformatics/bti125},
}</citation>
    </citations>
</tool>